{
  "_comment": "=============================================================================",
  "_description": "Sentinel Orchestrator Network (SON) - API Schema",
  "_purpose": "Strict JSON contracts for all API communications in the SON system",
  "_version": "2.0",
  "_architecture": "5-Agent Model (Sentinel, Oracle, Compliance, ZK-Prover, Consensus)",
  "_change_policy": "Breaking changes require 2 approvals in team chat",
  "_owner": "Shared - All Team Members",
  "_comment_end": "=============================================================================",

  "schema_version": "2.0",
  
  "external_api": {
    "scan": {
      "endpoint": "POST /api/v1/scan",
      "description": "Initiate a threat detection scan for a Cardano policy ID",
      "auth": "Bearer son_hackathon_token_2025",
      "request": {
        "schema_version": "2.0",
        "policy_id": "string (hex, 56 characters)",
        "creator_wallet": "string (optional, addr1... format)",
        "scan_depth": "string (optional, 'standard' | 'deep', default: 'standard')",
        "mock_mode": "boolean (optional, default: false)"
      },
      "response_success": {
        "status_code": 202,
        "body": {
          "task_id": "string (UUID)",
          "status": "processing",
          "ws_url": "string (WebSocket URL for real-time updates)",
          "estimated_time": "number (seconds, typically 3-5)"
        }
      },
      "response_error": {
        "status_code": 400,
        "body": {
          "error_code": "string (INVALID_POLICY_ID | INVALID_WALLET | RATE_LIMITED)",
          "message": "string (human-readable error description)"
        }
      }
    },
    "websocket": {
      "endpoint": "WS /ws/logs/{task_id}",
      "description": "Real-time event stream for scan progress and agent updates",
      "message_types": {
        "agent_start": {
          "event_type": "agent_start",
          "agent_name": "string (sentinel | oracle | compliance | zk_prover | consensus)",
          "data": { "policy_id": "string" },
          "timestamp": "ISO 8601"
        },
        "agent_complete": {
          "event_type": "agent_complete",
          "agent_name": "string",
          "data": {
            "vote": "string (SAFE | WARNING | DANGER)",
            "risk_score": "number (0-100)",
            "additional_fields": "object (agent-specific)"
          },
          "timestamp": "ISO 8601"
        },
        "workflow_complete": {
          "event_type": "workflow_complete",
          "agent_name": "null",
          "data": {
            "final_verdict": "string (SAFE | WARNING | DANGER)",
            "final_score": "number (0-100)",
            "capsule_id": "string",
            "total_duration_ms": "number"
          },
          "timestamp": "ISO 8601"
        },
        "error": {
          "event_type": "error",
          "agent_name": "string | null",
          "data": { "error": "string" },
          "timestamp": "ISO 8601"
        }
      }
    },
    "result": {
      "endpoint": "GET /api/v1/result/{task_id}",
      "description": "Retrieve final result after workflow completion",
      "response": {
        "task_id": "string",
        "status": "string (completed | failed)",
        "final_verdict": "string (SAFE | WARNING | DANGER)",
        "final_score": "number (0-100)",
        "capsule_id": "string",
        "capsule_metadata": "object (CIP-25 structure)",
        "agent_results": {
          "sentinel": "object",
          "oracle": "object",
          "compliance": "object",
          "zk_prover": "object",
          "consensus": "object"
        },
        "total_duration_ms": "number"
      }
    }
  },
  
  "internal_api": {
    "_description": "5-Agent sequential workflow: Sentinel → Oracle → Compliance → ZK-Prover → Consensus",
    
    "agent_a_sentinel": {
      "role": "expert_detector",
      "description": "Primary threat detector - scans contracts for vulnerabilities",
      "masumi_pricing": "per_scan_fixed",
      "input": {
        "schema_version": "2.0",
        "policy_id": "string (hex)",
        "scan_depth": "string (standard | deep)",
        "timestamp": "ISO 8601"
      },
      "output": {
        "agent": "sentinel",
        "policy_id": "string",
        "risk_score": "number (0-100)",
        "findings": [
          {
            "type": "string (threat pattern name)",
            "severity": "string (low | medium | high | critical)",
            "description": "string",
            "weight": "number"
          }
        ],
        "evidence_hash": "string (SHA-256)",
        "vote": "string (SAFE | WARNING | DANGER)",
        "timestamp": "ISO 8601"
      }
    },
    
    "agent_b_oracle": {
      "role": "external_data_verifier",
      "description": "Cross-verifies Sentinel findings with DEX liquidity and holder data",
      "masumi_pricing": "per_external_lookup",
      "input": {
        "sentinel_output": "object (Agent A output)",
        "policy_id": "string",
        "timestamp": "ISO 8601"
      },
      "output": {
        "agent": "oracle",
        "policy_id": "string",
        "liquidity_score": "number (0-100, higher = healthier)",
        "liquidity_depth_ada": "number",
        "trading_volume_24h": "number",
        "holder_count": "number",
        "holder_concentration": "number (percentage held by top 10)",
        "verification_status": "string (CONFIRMED | DENIED | UNCERTAIN)",
        "data_sources": [
          { "source": "string (WingRiders | Minswap)", "timestamp": "ISO 8601" }
        ],
        "vote": "string (SAFE | WARNING | DANGER)",
        "confidence": "number (0.0-1.0)",
        "risk_score": "number (0-100)",
        "timestamp": "ISO 8601"
      }
    },
    
    "agent_c_compliance": {
      "role": "compliance_checker",
      "description": "Sanctions screening and wallet risk assessment",
      "masumi_pricing": "usage_based",
      "input": {
        "sentinel_output": "object (Agent A output)",
        "oracle_output": "object (Agent B output)",
        "policy_id": "string",
        "creator_wallet": "string (addr1...)",
        "timestamp": "ISO 8601"
      },
      "output": {
        "agent": "compliance",
        "policy_id": "string",
        "creator_wallet": "string",
        "sanctions_match": "boolean",
        "sanctions_details": {
          "list_name": "string | null",
          "match_confidence": "number (0.0-1.0)"
        },
        "wallet_age_days": "number",
        "wallet_risk_indicators": [
          {
            "indicator": "string",
            "severity": "string (none | low | medium | high | critical)",
            "description": "string",
            "weight": "number"
          }
        ],
        "risk_modifier": "number (0.5-2.0)",
        "compliance_score": "number (0-100)",
        "vote": "string (SAFE | WARNING | DANGER)",
        "risk_score": "number (0-100)",
        "timestamp": "ISO 8601"
      }
    },
    
    "agent_d_zk_prover": {
      "role": "privacy_guardian",
      "description": "Generates Midnight-compatible ZK proofs for privacy-preserving verification",
      "masumi_pricing": "per_proof_generation",
      "input": {
        "sentinel_output": "object",
        "oracle_output": "object",
        "compliance_output": "object",
        "policy_id": "string",
        "timestamp": "ISO 8601"
      },
      "output": {
        "agent": "zk_prover",
        "policy_id": "string",
        "proof_hash": "string (SHA-256)",
        "verification_key": "string",
        "proof_valid": "boolean",
        "mock_mode": "boolean",
        "vote": "string (SAFE | WARNING | DANGER)",
        "risk_score": "number (0-100)",
        "timestamp": "ISO 8601"
      }
    },
    
    "agent_e_consensus": {
      "role": "consensus_mediator",
      "description": "Final arbiter - aggregates votes, submits to Hydra, writes CIP-25 capsule",
      "masumi_pricing": "per_finalization",
      "input": {
        "sentinel_output": "object",
        "oracle_output": "object",
        "compliance_output": "object",
        "zk_prover_output": "object",
        "policy_id": "string",
        "timestamp": "ISO 8601"
      },
      "output": {
        "agent": "consensus",
        "policy_id": "string",
        "final_verdict": "string (SAFE | WARNING | DANGER)",
        "final_score": "number (0-100)",
        "vote_breakdown": {
          "sentinel": { "vote": "string", "score": "number", "weight": 0.40 },
          "oracle": { "vote": "string", "score": "number", "weight": 0.25 },
          "compliance": { "vote": "string", "score": "number", "weight": 0.20 },
          "zk_prover": { "vote": "string", "score": "number", "weight": 0.15 }
        },
        "capsule_id": "string",
        "capsule_metadata": "object (CIP-25 structure)",
        "hydra_tx_id": "string",
        "hydra_confirmed": "boolean",
        "l1_tx_id": "string",
        "l1_confirmed": "boolean",
        "timestamp": "ISO 8601"
      }
    }
  },
  
  "vote_weights": {
    "_description": "Weighted voting for final consensus (must sum to 1.0)",
    "sentinel": 0.40,
    "oracle": 0.25,
    "compliance": 0.20,
    "zk_prover": 0.15
  },
  
  "verdict_thresholds": {
    "_description": "Risk score to verdict mapping",
    "SAFE": "0-40",
    "WARNING": "41-70",
    "DANGER": "71-100"
  },
  
  "threat_proof_capsule": {
    "_description": "CIP-25 compliant NFT metadata for ThreatProof Capsule",
    "structure": {
      "721": {
        "<policy_id>": {
          "ThreatProof_<scan_id>": {
            "name": "string (ThreatProof Capsule #<scan_id>)",
            "description": "string (SON threat analysis verdict)",
            "image": "string (ipfs://...)",
            "mediaType": "string (image/png)",
            "verdict": "string (SAFE | WARNING | DANGER)",
            "risk_score": "number (0-100)",
            "vote_weights": {
              "sentinel": 0.40,
              "oracle": 0.25,
              "compliance": 0.20,
              "zk_prover": 0.15
            },
            "vote_summary": {
              "sentinel": "string",
              "oracle": "string",
              "compliance": "string",
              "zk_prover": "string"
            },
            "evidence_merkle_root": "string (SHA-256)",
            "hydra_tx_id": "string",
            "hydra_signatures": ["string"],
            "zk_proof_hash": "string",
            "analyzed_policy_id": "string",
            "version": "2.0",
            "timestamp": "ISO 8601"
          }
        }
      }
    }
  },
  
  "test_vectors": {
    "_description": "Test data for UI and integration testing",
    "danger_token": {
      "policy_id": "deadbeef0000000000000000000000000000000000000000000000ab",
      "expected_verdict": "DANGER",
      "expected_score_range": "80-100"
    },
    "warning_token": {
      "policy_id": "warn0000000000000000000000000000000000000000000000000000ab",
      "expected_verdict": "WARNING",
      "expected_score_range": "41-70"
    },
    "safe_token": {
      "policy_id": "safe0000000000000000000000000000000000000000000000000000ab",
      "expected_verdict": "SAFE",
      "expected_score_range": "0-40"
    }
  }
}
